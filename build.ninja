cxx = clang++-4.0
cflags = -std=c++14
fflags = -pthread
source = project.cc

rule libfuzzer-ar-build
    command = cd ./source && ./build.sh

rule libfuzzer-build
    command = $cxx $cflags $fflags ./source/libFuzzer.a $in -o $out

rule normal-build
    command = $cxx $cflags $in -o $out

build source/libFuzzer.a: libfuzzer-ar-build
build fuzzer: libfuzzer-build $source
build test: normal-build test.cc
